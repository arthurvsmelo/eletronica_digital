TITLE "Contador síncrono de 0 a 9 crescente/decrescente";

SUBDESIGN counter_mod9
(
	clock, clear, load, enable, dir, din[3..0] :INPUT;			           		-- portas de entrada (dir: direction up-HIGH/down-LOW)
	q[3..0], ct :OUTPUT;                                               		-- saída do contador de 4 bits, indicador de término de contagem
)

VARIABLE
	count[3..0] :DFF;                                                     	-- células de contagem com flip flops tipo D
 
BEGIN
	count[].clk = clock;                                                  	-- conexão síncrona dos clocks
	count[].clrn = !clear;                                                	-- clear assíncrono ativo em HIGH
 
 IF load THEN 
	count[].d = din[];  	                                     				 	-- carga síncrona
 
 ELSIF !enable THEN 
	count[].d = count[].q;     	                      							-- mantém a contagem enquanto enable for LOW
 
 ELSIF !dir THEN count[].d = count[].q - 1;                           		-- decrementa
 
 ELSE count[].d = count[].q + 1;                                       		-- incrementa
 
 END IF;
 
 IF ((count[].q == 0) & !dir # (count[].q == 9) & dir) & enable THEN 		-- se o contador estiver ativo, verifica as condições de contagem mínima e máxima
	ct = VCC;                                                   			   -- sinal que informa o fim da contagem
	
 ELSE 
	ct = GND;
	
 END IF;
 
	q[] = count[].q;                                                      	-- saída do contador
 
END;